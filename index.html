<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¯Ù‚ÙŠÙ‚ ÙˆØ¹Ø±Ø¶Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        /* CSS: Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØµÙØ­Ø© */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f4f9;
            color: #333;
            text-align: center;
        }

        .container {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 700px; 
            margin-bottom: 20px;
        }

        h1 {
            color: #007bff;
            margin-bottom: 20px;
        }

        button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #218838;
        }

        #location-data {
            margin-top: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: right;
            line-height: 1.8;
            background-color: #e9ecef;
        }

        .error {
            color: #dc3545;
            font-weight: bold;
        }

        /* ØªØ­Ø¯ÙŠØ¯ Ø­Ø¬Ù… Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
        #mapid {
            height: 350px; 
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ Ù…Ø­Ø¯Ø¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¯Ù‚ÙŠÙ‚ ÙˆØ¹Ø±Ø¶Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</h1>
        <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ ÙˆØ¹Ø±Ø¶Ù‡ Ø¹Ù„Ù‰ Ø®Ø±ÙŠØ·Ø© OpenStreetMap.</p>
        <button onclick="getLocation()">ØªØ­Ø¯ÙŠØ¯ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
        
        <div id="location-data">
            <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯:</strong> <span id="status">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø·Ù„Ø¨Ùƒ...</span></p>
            <p><strong>Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (Latitude):</strong> <span id="latitude">--</span></p>
            <p><strong>Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (Longitude):</strong> <span id="longitude">--</span></p>
            <p><strong>Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ© (Accuracy):</strong> <span id="accuracy">--</span></p>
        </div>
        
        <div id="mapid"></div>
    </div>

    <script>
        // JavaScript: Ù…Ù†Ø·Ù‚ ØªØ­Ø¯ÙŠØ¯ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        
        let map = null; 
        let currentMarker = null;

        // Ø¯Ø§Ù„Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© (Leaflet)
        function initializeMap() {
            if (map) return; 

            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø© 
            // Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ù…Ø¹ ØªÙƒØ¨ÙŠØ± 5
            map = L.map('mapid').setView([24.774265, 46.738586], 5); 

            // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© (Tiles) Ù…Ù† OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19,
            }).addTo(map);

             // Ø¥ØµÙ„Ø§Ø­ Leaflet: Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨ Ø­Ø¬Ù…Ù‡Ø§ Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
             map.invalidateSize();
        }

        // Ø¯Ø§Ù„Ø© Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
        function getLocation() {
            initializeMap(); // ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡
            
            const status = document.getElementById('status');
            const latitudeEl = document.getElementById('latitude');
            const longitudeEl = document.getElementById('longitude');
            const accuracyEl = document.getElementById('accuracy');

            if (!("geolocation" in navigator)) {
                status.textContent = "âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø§ØµÙŠØ© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.";
                return;
            }

            status.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹...";
            latitudeEl.textContent = "Ø¬Ø§Ø±ÙŠ...";
            longitudeEl.textContent = "Ø¬Ø§Ø±ÙŠ...";
            accuracyEl.textContent = "Ø¬Ø§Ø±ÙŠ...";

            // Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø¹ Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© (enableHighAccuracy: true)
            const options = {
                enableHighAccuracy: true,
                timeout: 10000, 
                maximumAge: 0 
            };

            // ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ success Ø£Ùˆ error Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            navigator.geolocation.getCurrentPosition(success, error, options);
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ (Ø¹Ù†Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹)
        function success(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const accuracy = position.coords.accuracy;
            
            document.getElementById('status').textContent = "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ¹Ø±Ø¶Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©.";
            document.getElementById('latitude').textContent = lat.toFixed(6);
            document.getElementById('longitude').textContent = lon.toFixed(6);
            document.getElementById('accuracy').textContent = `${accuracy.toFixed(2)} Ù…ØªØ±`; 

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
            const latLng = [lat, lon];

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
            if (currentMarker) {
                map.removeLayer(currentMarker);
            }

            // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯
            currentMarker = L.marker(latLng).addTo(map)
                .bindPopup(`**Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ**<br>Ø§Ù„Ø¯Ù‚Ø©: ${accuracy.toFixed(2)} Ù…ØªØ±.`)
                .openPopup();

            // ØªØ­Ø±ÙŠÙƒ Ù…Ø±ÙƒØ² Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØªÙƒØ¨ÙŠØ±Ù‡Ø§
            map.setView(latLng, 16);
            map.invalidateSize(); // ØªØ­Ø¯ÙŠØ« Ø­Ø¬Ù… Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ (Ø¹Ù†Ø¯ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯)
        function error(err) {
            const status = document.getElementById('status');
            let errorMessage = "ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯.";
            
             switch(err.code) {
                case err.PERMISSION_DENIED:
                    errorMessage = "ğŸš« ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…. (ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­).";
                    break;
                case err.POSITION_UNAVAILABLE:
                    errorMessage = "âš ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ (GPS/Ø§Ù„Ø£Ø¨Ø±Ø§Ø¬ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©).";
                    break;
                case err.TIMEOUT:
                    errorMessage = "â±ï¸ Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù‚Ø¨Ù„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©.";
                    break;
                default:
                    errorMessage = `âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ: (${err.message})`;
                    break;
            }
            status.innerHTML = `<span class="error">${errorMessage}</span>`;
            document.getElementById('latitude').textContent = "--";
            document.getElementById('longitude').textContent = "--";
            document.getElementById('accuracy').textContent = "--";
        }
        
        // **Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:** Ø§Ø³ØªØ®Ø¯Ø§Ù… DOMContentLoaded Ù„Ø¶Ù…Ø§Ù† ØªÙ‡ÙŠØ¦Ø© Leaflet Ø¨Ø¹Ø¯ Ø¨Ù†Ø§Ø¡ Ø¹Ù†Ø§ØµØ± HTML
        document.addEventListener('DOMContentLoaded', initializeMap);
    </script>
</body>
</html>
